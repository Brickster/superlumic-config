---

- hosts: all
  connection: local

  roles:
    - profile-all
    - profile-developer
    - profile-gamer
    - profile-user

  vars:
    - computername: Air
    - git_user_name: Marcus Rosenow
    - git_user_email: 2048345+Brickster@users.noreply.github.com

  tasks:
    # set profile picture
    - name: register Profile picture
      shell: dscl . -read "{{ lookup('env', 'HOME') }}" Picture
      register: profile_picture
      changed_when: profile_picture.stdout.find('laptop.png') == -1
    - name: install profile picture
      become: true
      copy:
        src: 'files/laptop.png'
        dest: '/Library/User Pictures'
      when: profile_picture is changed
    - name: delete JPEGPhoto setting
      shell: dscl . -delete "{{ lookup('env', 'HOME') }}" JPEGPhoto
      when: profile_picture is changed
    - name: delete Picture setting
      shell: dscl . -delete "{{ lookup('env', 'HOME') }}" Picture
      when: profile_picture is changed
    - name: set Picture setting
      become: true
      shell: dscl . -create "{{ lookup('env', 'HOME') }}" Picture '/Library/User Pictures/laptop.png'
      when: profile_picture is changed

    - name: create SSH directory
      file: path="~/.ssh" state=directory
    - name: register github_pro_rsa stat
      stat: path="~/.ssh/github_pro_rsa"
      register: github_pro_rsa_stat
    - name: install github SSH key
      copy:
        dest: ~/.ssh/github_pro_rsa
        mode: 0600
        content: |
          $ANSIBLE_VAULT;1.1;AES256
          32316236323561393636323932366136623766636635643632366437616332323063343139323538
          6661626539643136376565323734633735393435623036310a333965663035303263656630376161
          32643664313333323937643432366230316261313964356539313832636434643864666330343437
          3866393263376436650a326563306162336433663433303932373837646662643633663537336631
          35376531303162623164313238626561646638633562366334663461616565316330616339333938
          33376234336130383638386136363561343039386337376134323064333061363061366461323439
          33313731376639633432323066616138643163643832613332333934316162313234623433313633
          63353733646132333930346236373365343734613031353631366230306163386231353536653234
          37643230303635656663653065613831653036613036346431393630383938306535633639663938
          61323136363762316662343036623761366237303839373262386436623539373665616662366133
          34663930646631396334373563343832366338366262363963353561626233316162383839626361
          38633361383138373961623231616164396337363162326530393763396434613465623664353133
          61366533363933356163636639363230346331626266623931646263323533313839386666383531
          32653830346365383166323262336335376438383534306534366333346636646330303631323862
          63623565373166306565633335396330383035306336316438346663393262316462626562373563
          64636261623363383533356639383937623830356336373636653565383963626532313862396566
          31396365653131313735363362633434353434383964643866386330343537393439343161313035
          34396133623237656566643061303966613363326166373964386339376337346462343266323230
          61353865346465356463386631346639616266316139663264626661346463653532613130383064
          30353966653062323435643237666362386130386537666535616134343438663661373939633663
          35383066653164633133616339303336353862623335646631613932633663653464666436653437
          39313864613861353335613763383462653265303835326137383935306461306337363832313630
          39666131393763326430666434323565323666616666336236383633366365663365373963613061
          66323561313637343331333364333339353236616333373432373763383763353735323636653565
          65323034303131303165333633643163313139623766326437663534316530393462363765653864
          30386134333461313965653863313065366331636564666135323638663734623834333330616266
          62616434656365656331616662613463663739336366343434366135333730356565333064646634
          38363464623938613264613861366136376333333466623039626334363632623163396235376136
          37326564383465616361356533653962303963326366366634396462393264323839636433306363
          39643238646534333266356263626337386231343364346638393838333066306530633935356138
          66313031323636343037373133646165303633643763623231623566313338346530356163663565
          31376663623635313335303532616265323764333631333630326134373935656565393865343235
          31323562353337646665386363376531663761353737623466396635313235303061383035663435
          34656233373331663332386134383037663932613464613035623034393065333033386334336532
          66336635343163343533656334343637393337616439356635343064346432333334623130636334
          36336164356165393937303132653737333261613937626462616664343032643930303164646435
          37393233323931393433643366323039646331303431383966303139373537343830353832363265
          66646561376637333739343734666436383134386165663039303633313230313131356262343731
          64333536346562346630396139393834666630343466643738613734323436313138303339653166
          37373862393530636561326132653335346565396564376166336335653565316565353163363461
          38323134373833326664316466656663333135343864306230663861343333656361623938356432
          37656134353637653436316239366635666163373139316162363433353432633763623061626433
          32666238346662666430356338393034363835323464303331363538386431333932316231643761
          65316631393839366166303838343237633335393665386530633162343966653961636438333863
          35306237636436653534616231343434376436396332653439343037376164316166623966643262
          65336266623633386466623135323239343966363263373333643937613634363230383831393430
          66313463333235346461633461623563613230666430366335373636376432313461303631333766
          35313335326539643466396163326234646438383136623933366530336239383138366661643331
          64363935333336643936323565346432666535666161626332353735396266396131663762353961
          66656361383261306564373636386632343237646639363961633434623633656437313263393033
          66333261373238616663653266336461316462616165613431356461386136373663373861326636
          30386163386639316533616665313438323362383762333532393333653261393034363862326131
          37393431373135623162636264326663353331626339363761356265666338303764613365306534
          63666333326236656363663762343037376663306463323061323937323138323538303336633936
          66643363356131643133313237373162323032346563313434373938386232373861373130326665
          65663532666439653834356262373630393864663333356236313339643264383364353366393136
          33323037333765303064353262376564373331653065663331393233346462316639343532343731
          64333836356134313636653036623433383632343364383439643834663533333034316363636236
          30336331393236663736363937623532343166393738363164623736363666643831316133346162
          63363637326432666439626134393664346439356135316630316361313264333131666134623365
          38613932663437373436353533356461643833653330366666633262343433663138303264353438
          35336435656435613035633138633137666261626535336136376235323332643661383836353664
          30663939623633313365346465303932646131376361303635343339363236336365663838343366
          63323532376466323162313061303765306537386361303338356534666162323863623262383666
          39653235336333666238316432333838376563346363383366393731303635343165326263326132
          37663535363861653633363638346565613963643832633535333861626639373864313532323963
          62346236636165313533376237393139653462306139633632646334336364336436336438666139
          39363038353665313165373433623437393963343131643961613936653734643535316164366539
          33363165363339393366373730633163313239636634633137643962323735313963633736633237
          32336366333631613137633733393034336635653662366135373964633966616533613764323231
          34393961623564666131363637323566336630613965633565306662396334623537326338313166
          38366562383762376536393732613236326432376231356661643133643263363663613931353561
          34333065623734366633383433663664316163613934383964636135336234396366366130663731
          63383530303733386463626336626239623864353334333532663537343164363832643732643664
          65323034313237643562626230643231393630346337393164663139376430663663623761626666
          36373538623336333431656162623461636165343238393137343230653164393063336561366363
          61333535373736353761343936656334396662666337613462343738326532383633613762313564
          65373262616139373063373931333966323335616236326230313434343030656437333461306262
          66356435653863373831343034616530343732336666633137616338306231633061633730383431
          39386633363163353038393030636465623036626565613734333731373434386235306262623937
          65373239613433393564346639303965376461376266303536646432313432386364646265656630
          37393935366638626163666661323232366539366539633662383538396132353435313238643030
          34646331633335633466326263373030613466636237323162306632386631363537633665303132
          36373733666466393433353238656265333966653863336637303365343466663432313438313737
          63393763363932313834326363366364633265653837333532366163653735653635616233336430
          35633037356362303831316332376131663639363862616561356665396566613239333964616132
          30656138383434623034373261383366393739373736393330366363323936366239633863343939
          38373036353039623663643736353830656161353431653531386466333966363131653862396337
          35333563393236393862323736313662323232613631643366386532616361323063666130623434
          35313639663963643731353265656131313366303536333332393335333333383066343439666433
          66393261333132653634326565643761303638646330383830306435666365326533353561343064
          37623465373639386636393961663432306230383837653537393262626239303936316333623239
          65663930356165383230366263393963316166633730323732616265663565656230363832373465
          30393235336163623131623238613730353637396166303363346433376261633732626463383234
          30326236326461336561613633643166363133323632616139663139636531383836303966306339
          35656462303361383161373761383530666163646364353033376666343535386135373264356533
          33303132333234663163636535646537613262393462383734663936643134363639646561386462
          30656435366463646364303062386130663133303565613139616137383135383935393933303133
          37373631383861323738323464643035643339393431373932326331316164623663383133363462
          39616264633337663230643835636363313937393338323961363631353765356562666335626561
          38313665653137396530313531653430383166323461663834376136383130666230313238386230
          39663666616338626132366565353164333165363265663433646336336236333032623431393164
          34663430323436643964396138633639353064383138336632373631616266336231333839616430
          33396463616366616366646666643534623530323431633335616265646532373866343030396631
          37306332613135396664336161323835306337613865663630666563623937363333393164336365
          63666563386632383763343032383262666435623665613363653433653234393139363863336537
          66646139656561343036336436393034343633326165366132366138663433303137383130383138
          32393636613733613032623539363265346231643035316637316639653833306461363932313831
          32316639383766333666373933666631363332333765313531393330353330373263656137303765
          62316561386138653166393039656661336235353438366236313363643030353936353838373734
          35343831396166323566343436343635666338356437656139353364633736383261313831346232
          33626532633530636333306135613738313133343366333366613563393465323935383361316236
          65393562646666356537366635393231643036333435343334646631323435633338383834366533
          64373438646130636539646433363865663537663632653233663163626432313037313265616336
          66346236626235623961313332323236623335356234663839336234326166353838306464366534
          30313963373964666235626233323132613833306236316136613031323164393031656263376539
          39613461326336313237366461336365346165396230626539313162343763313133633735333632
          34363031663733373565376433336639343533383537356338366331613434313865303562343638
          35396139323738373333366163356465363365376633373737633961613561613836306436303566
          39613736663537326462373234343063666462323866373831313633626166383137396239626465
          35616533343561653761363637623639316364636463343564353639303433613739343337376139
          61613963383339333438316335333538626136623931663865343562373038633536656565363336
          36316636363830633531353239613630613630613531363930373733373435383462656337333737
          63326263393039336666656635633237666131633434373537326366316161353963393130383963
          65316239353939313166373836343561326464613962396163383663633163623863663037383365
          32386637363661393135613032333038373735303564663637623761303138333063613866336332
          36626139326633356663333839643566386139373430363163336264376162333165303365313634
          36323265303166633364383035333430336630383530373962303230316331333739353639646339
          66326637343031303361303064366231313165613534346238333765353466353165303730393164
          38613736393236643438313134396131353235373765336238613738333864373766326666396662
          37656334366365613465303635653337346533643063363833343038396564643931666364313166
          64316438303837353864376561323331353464356432323038353931613534323866356335353335
          31366235396230393661623361653966356337653239326434376436326366393935336237633566
          30643961643937613439353035646666366663326235353832373664613537303265346533626164
          61393431353336373934643038666134636233383437643332396335623563383431363264336662
          30643966656262333461303137393730303532376135383436363537373336366331313734626233
          38306135666439663565383862643565363466396231373837626364643966656565396531353761
          34393439303861653865343730383863353761336362313937353361343363333263353464373462
          66633337333838386139333062623334613065626162666661643130323436343864316363326164
          30373135346137653162303561656662656463383232396161653138323161353934646135393663
          62373262643164333435653936306538396335353133363432613763393364653030326431336238
          62623135656437613035646263626630653163343135373735393962373664333331633530636533
          38636565656566663330626362613233303337613338306139353363633731666537623738316139
          36336532326633643233646665366435343564353764333235316665343137373539643965363165
          36306265353534326664663133396263316666636130653330633835636338613366323763396636
          31656462623063636630396134323466303737386161653035316431393666663336323334613831
          64633966326464656538306566323162363065356661373766633266383036343163346635393931
          64336235323632306539613537343431316262393733616338653336373765396238316435386636
          39306632666530313931336433313061636163623234393637626161653033333363343838653137
          38613161643561336162666363623332333234613230653035303161303639303634376664376632
          31616465633732326132396565373739663063303037386463333833343831353932633064643838
          63373466323365306539373038306437373166393332623666383335633433663961383237353565
          62616631363364623731353230383033366563613434643533643665333161636238623533363730
          62346336323064633430396438306635373335663530373035306336326635613839333436633133
          39336565383364313766316665393466323237646165636665633162663833663135316433346431
          36336563323264323434316366383263633535386166343061643930343338373863393864666366
          63313437393335323337313036326362616464643461636230653463313062616233396133626232
          32303766663030366237646162326338613764303564353564306537333539616562303161623330
          39306439323239393234643135383865343036313861626164393066633131313864333035633463
          62343864383366383935353531613637393538396433643938346162373533393737363061626263
          66353232656564303435633261346261623331336464333633396562303539396261346331323738
          37383231316464373665393766346231323639616532363435393661386564333237323562316537
          35323734656633353561316230326431343637356134353838326339316265353364323966623438
          39303331356133386663366661303930333436303731653930326238613833353630366330393664
          63336363646532653834336435626530663138613661663135613237373938623362623332336330
          30356432393237666537336333666538613862333134613138336133326537333561343864386634
          62633033626138373638613961386137643132363861633266663634646564653637306534346561
          37396561636235613962323338616631373563353738353934336534666439313931633064333166
          63346663373334636261383638386362363966643864353930616132393138633339623334626638
          3536333961656161386634303530373862633063626161666235
      when: not github_pro_rsa_stat.stat.exists
    - name: add identity to ssh config
      lineinfile:
        dest: ~/.ssh/config
        create: yes
        state: present
        line: |
          IdentityFile ~/.ssh/github_pro_rsa

          Host *
            UseKeychain yes
      when: not github_pro_rsa_stat.stat.exists
    - name: add github key to ssh
      shell: ssh-add ~/.ssh/github_pro_rsa
      when: not github_pro_rsa_stat.stat.exists

    # install pushover config
    - name: register .pushoverrc stat
      stat: path="~/.pushoverrc"
      register: pushoverrc_stat
    - name: install pushover config
      copy:
        dest: ~/.pushoverrc
        mode: 0600
        content: |
          $ANSIBLE_VAULT;1.1;AES256
          61303363653566643832353138343331333231656265373838666336666235646238396433653531
          3835653162643539656565326430323330656165653966350a383864643564383039373932336535
          31336238356137353130386565313337306132313633643166303961336230353934666636303863
          3333643535393532630a363530353937343438323435333630313937363765626332326138656464
          66396537366664343264396263646139376231386135343533306566363262356231333661653163
          39613537336161653334336637643937666139313162353739323366613261326563613738313934
          34613262646434356437313164366633363366313731373962626163666137306638613739323761
          36343034353736383538373062373165646439353434393937373764666563653032353532376634
          66616139326233393963323030323831646138396339316336386435393132616234393235326231
          30663939363032656538653537366234326236333366646337303562383837376635616237643563
          35393437316665386132326662626332613531303366363137306236633861323562306230326630
          66326263646464666263393366636662613131653562643863666333373363626639623461633238
          36333766333036303736316530663735613030666262643834653338356462323631386335663738
          6131346534363332626632643461653532623963613934393831
      when: not pushoverrc_stat.stat.exists

    # setup bash profile
    - name: register .profile stat
      stat: path="~/.profile"
      register: profile_stat
    - name: setup .profile
      copy: src="files/.profile" dest="~"
      when: not profile_stat.stat.exists

    # install mackup config
    - name: register .mackup.cfg stat
      stat: path="~/.mackup.cfg"
      register: mackupcfg_stat
    - name: setup .mackup.cfg
      copy: src="files/.mackup.cfg" dest="~"
      when: not mackupcfg_stat.stat.exists

    # set finder toolbar items
    - name: check for toolbar configuration dict
      shell: /usr/libexec/PlistBuddy -c "print :'NSToolbar Configuration Browser'" ~/Library/Preferences/com.apple.finder.plist
      register: toolbar_configuration_check_result
      changed_when: false
      ignore_errors: yes
    - name: add toolbar configuration dict
      shell: /usr/libexec/PlistBuddy -c "add :'NSToolbar Configuration Browser' dict" ~/Library/Preferences/com.apple.finder.plist
      when: toolbar_configuration_check_result.rc
    - name: check for toolbar item settings array
      shell: /usr/libexec/PlistBuddy -c "print :'NSToolbar Configuration Browser:TB Item Identifiers'" ~/Library/Preferences/com.apple.finder.plist
      register: toolbar_check_result
      changed_when: false
      ignore_errors: yes
    - name: add toolbar item settings array
      shell: /usr/libexec/PlistBuddy -c "add :'NSToolbar Configuration Browser:TB Item Identifiers' array" ~/Library/Preferences/com.apple.finder.plist
      when: toolbar_check_result.rc
    - name: add toolbar item setting entries
      shell: /usr/libexec/PlistBuddy -c "add :'NSToolbar Configuration Browser:TB Item Identifiers:' string '{{ item }}'" ~/Library/Preferences/com.apple.finder.plist
      when: toolbar_check_result.rc
      with_items:
        - com.apple.finder.BACK
        - NSToolbarFlexibleSpaceItem
        - com.apple.finder.SWCH
        - com.apple.finder.PATH
        - NSToolbarSpaceItem
        - com.apple.finder.SHAR
        - com.apple.finder.ACTN
        - NSToolbarFlexibleSpaceItem
        - NSToolbarFlexibleSpaceItem
        - com.apple.finder.SRCH

    # set finder toolbar items to item only
    - name: register toolbar display mode
      shell: /usr/libexec/PlistBuddy -c "print :'NSToolbar Configuration Browser:TB Display Mode'" ~/Library/Preferences/com.apple.finder.plist
      register: tbdisplaymode_default
      changed_when: false
      ignore_errors: yes
    - name: set toolbar display mode
      shell: /usr/libexec/PlistBuddy -c "add :'NSToolbar Configuration Browser:TB Display Mode' integer 2" ~/Library/Preferences/com.apple.finder.plist
      when: tbdisplaymode_default.stdout != '2'

    # set finder icon view settings
    - name: set finder icon view settings
      shell: /usr/libexec/PlistBuddy -c "set :'StandardViewSettings:IconViewSettings:{{ item.property }}' {{ item.value }}" ~/Library/Preferences/com.apple.finder.plist
      with_items:
        - property: gridSpacing
          value: 30
        - property: textSize
          value: 12
        - property: showItemInfo
          value: false
        - property: iconSize
          value: 44
        # 'name' really maps to 'sort by'
        - property: arrangeBy
          value: name

    # set finder desktop view settings
    - name: set finder desktop view settings
      shell: /usr/libexec/PlistBuddy -c "set :'DesktopViewSettings:IconViewSettings:{{ item.property }}' {{ item.value }}" ~/Library/Preferences/com.apple.finder.plist
      with_items:
        - property: gridSpacing
          value: 25
        - property: textSize
          value: 12
        - property: iconSize
          value: 44
        - property: arrangeBy
          value: grid

    - name: set OS X defaults
      osx_defaults: domain={{ item.domain }} key={{ item.key }} type={{ item.type }} value={{ item.value }}
      with_items:
        # set output sound when changing volume
        - domain: NSGlobalDomain
          key: com.apple.sound.beep.feedback
          type: integer
          value: 1

        - domain: 'NSGlobalDomain'
          key: 'NSTableViewDefaultSizeMode'
          type: integer
          value: 1
        - domain: 'NSGlobalDomain'
          key: 'NSNavPanelExpandedStateForSaveMode'
          type: boolean
          value: true
        - domain: 'NSGlobalDomain'
          key: 'AppleActionOnDoubleClick'
          type: string
          value: 'Minimize'

        # screen saver
        - domain: 'com.apple.screensaver'
          key: 'askForPassword'
          type: integer
          value: 0

        # set tabbing between all UI elements
        - domain: 'NSGlobalDomain'
          key: 'AppleKeyboardUIMode'
          type: integer
          value: 2

        # clock
        - domain: 'com.apple.menuextra.clock'
          key: 'IsAnalog'
          type: integer
          value: 1

        # finder
        - domain: 'com.apple.finder'
          key: 'ShowTabView'
          type: boolean
          value: true
        - domain: 'com.apple.finder'
          key: 'ShowRecentTags'
          type: boolean
          value: false
        - domain: 'com.apple.finder'
          key: 'ShowExternalHardDrivesOnDesktop'
          type: boolean
          value: false
        - domain: 'com.apple.finder'
          key: 'ShowHardDrivesOnDesktop'
          type: boolean
          value: false
        - domain: 'com.apple.finder'
          key: 'NewWindowFilePath'
          type: string
          value: 'file:///Users/marcus/'

        # dock
        - domain: 'com.apple.dock'
          key: 'autohide'
          type: boolean
          value: true
        - domain: 'com.apple.dock'
          key: 'minimize-to-application'
          type: boolean
          value: true
        - domain: 'com.apple.dock'
          key: 'show-process-indicators'
          type: boolean
          value: true
        - domain: 'com.apple.dock'
          key: 'tilesize'
          type: float
          value: 55
        - domain: 'com.apple.dock'
          key: 'wvous-tl-corner'
          type: integer
          value: 10
        - domain: 'com.apple.dock'
          key: 'wvous-tl-modifier'
          type: integer
          value: 0
        - domain: 'com.apple.dock'
          key: 'wvous-tr-corner'
          type: integer
          value: 4
        - domain: 'com.apple.dock'
          key: 'wvous-tr-modifier'
          type: integer
          value: 0

        # set mouse settings --------------------------------------
        # right click
        - domain: 'com.apple.AppleMultitouchMouse'
          key: 'MouseButtonMode'
          type: string
          value: 'TwoButton'
        - domain: 'com.apple.driver.AppleBluetoothMultitouch.mouse'
          key: 'MouseButtonMode'
          type: string
          value: 'TwoButton'
        # swipe to navigate pages
        - domain: 'NSGlobalDomain'
          key: 'AppleEnableMouseSwipeNavigateWithScrolls'
          type: boolean
          value: true

        # trackpad
        - domain: 'com.apple.driver.AppleBluetoothMultitouch.trackpad'
          key: 'Clicking'
          type: integer
          value: 1
        - domain: 'com.apple.AppleMultitouchTrackpad'
          key: 'Clicking'
          type: integer
          value: 1
        - domain: 'com.apple.dock'
          key: 'showAppExposeGestureEnabled'
          type: boolean
          value: true

    - name: set OS X defaults for currentHost
      osx_defaults: host=currentHost domain={{ item.domain }} key={{ item.key }} type={{ item.type }} value={{ item.value }}
      with_items:
        # set trackpad tap-to-click (yes, trackpad)
        - domain: NSGlobalDomain
          key: com.apple.mouse.tapBehavior
          type: integer
          value: 1
        # set button/menu appearance to "Graphite"
        - domain: NSGlobalDomain
          key: AppleAquaColorVariant
          type: integer
          value: 6

    # install Mac App Store applications
    - name: register Mac App Store account
      shell: mas account
      register: mas_account
      changed_when: no
      failed_when: no
    - name: register Mac App Store applications
      shell: mas list
      register: mas_list
      changed_when: no
    - name: install Mac App Store applications
      shell: mas install {{ item }}
      when: mas_account.rc == 0 and item|string not in mas_list.stdout
      with_items:
        - 1107421413  # 1blocker
        - 402355593   # chronicle
        - 1026349850  # copied
        - 1055511498  # day one
        - 924726344   # deliveries
        - 407963104   # pixelmator
        - 568494494   # pocket
        - 880001334   # reeder
        - 446107677   # screens
        - 1176895641  # spark
        - 577085396   # unclutter
        - 497799835   # xcode

    - name: clone third party git repositories
      git: repo={{item.repo}} dest={{item.dest}}
      with_items:
        - repo: https://github.com/Cortys/comic-backup.git
          dest: ~/Development/third-party/comics-backup
