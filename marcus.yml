---

- hosts: all
  connection: local

  roles:
    - profile-all
    - profile-developer
    - profile-gamer
    - profile-user

  vars:
    - computername: Air
    - git_user_name: Marcus Rosenow
    - git_user_email: Brickstertwo@users.noreply.github.com

  tasks:
    # set profile picture
    - name: register Profile picture
      shell: dscl . -read "{{ lookup('env', 'HOME') }}" Picture
      register: profile_picture
      changed_when: profile_picture.stdout.find('laptop.png') == -1
    - name: install profile picture
      become: true
      copy:
        src: 'files/laptop.png'
        dest: '/Library/User Pictures'
      when: profile_picture|changed
    - name: delete JPEGPhoto setting
      shell: dscl . -delete "{{ lookup('env', 'HOME') }}" JPEGPhoto
      when: profile_picture|changed
    - name: delete Picture setting
      shell: dscl . -delete "{{ lookup('env', 'HOME') }}" Picture
      when: profile_picture|changed
    - name: set Picture setting
      become: true
      shell: dscl . -create "{{ lookup('env', 'HOME') }}" Picture '/Library/User Pictures/laptop.png'
      when: profile_picture|changed

    - name: create SSH directory
      file: path="~/.ssh" state=directory
    - name: register github_air_rsa stat
      stat: path="~/.ssh/github_air_rsa"
      register: github_air_rsa_stat
    - name: install github SSH key
      copy:
        dest: ~/.ssh/github_air_rsa
        mode: 0600
        content: |
          $ANSIBLE_VAULT;1.1;AES256
          38333762663666356365653639383433306237356236666334373535356236303830376262363163
          6466306361306434313833353538303332323165656261610a336535633438383534373933333533
          31626135653363323031633038646264626538656237653532393432396366376437643963303635
          6366363032306131370a616563646435343166306364663163356330316665393065376161353232
          66663332653163643335303463336364633039393138313665353037623265633930336231323564
          31303535363066343162393361653263336662623931623335383738626632376165336563323338
          62333263323733613032336366303139646133383139663662386463306562656539306231326662
          30326639623463326439653965656536333766343239303963663763343364333730313430643032
          66663766373662346131373830313863643030626237376339346130343134303238653963303138
          39313735373830303264363566363030313830306233383266376139353834656161343831386133
          65323663633134646332313832326634643862616362343336393438343639386131663139376537
          32336431613266373937646538616336326534323466336135313237316537663135383831363965
          63346536643466623563303831613533313661623539323136323061303937346637653430316461
          39383664366635303266393935623963616165313332343832636632633931643863366665323934
          39633462313165656539393235346264343831363366313761376265373934373563363465376435
          64663737623230393832383635373334653030613635653130613264336236363637363534303066
          37636130346330353536306331353330643131333763373331373466643934363836376539333164
          39346634393039306539626533666161313137376262633236353931356461363065663638366263
          37653732353337343534623538666466356263303562343039666364353534326665633334643239
          64313437336562356166363937353931666562303830663266616566656362383665303631336233
          36323037343835343465333533303835656665626130633533383664383230326435323261343962
          39633936633734393363326336353563343535333161306466346138353866323738626632643637
          34373837663364623938373130363639303761646630653262346233616530373433373861356165
          65636565653063316462636438363964613039313565366265326432313033366236306436343339
          33393837396264373430643465653566393634666665336266643630313434353763623432323134
          63373563363437616134653130306262383038323561366365366466666131383135343039353231
          66643863373238636563643866383536643033613632366435633834613437653932626138386239
          31623731313461363434353835666165666534383661353931376461636161636439613035383562
          61303662646532343861306163326266366137333030636566393762326531313031343038623830
          30356161656536366239333563653832326433303166623861376638353533623732323239343739
          38363837623234643062313330376565383335343762363830663832383163396563626239616563
          39306565333063336337353135666535396338353764653638346563363063616564326438363964
          63386530656534666161313736663233356562323039353266616438616339623132646135643637
          63333031333032303266343936333935666233643165313665623437646233326433643863363362
          66356564623535646639326331353134643365383439336437646133336236633562396232636338
          62363562393132333862373665653835373136626536356636366632393865336664333436646266
          61346166666433356362393436636137363639623739653533393162633263643634323365653031
          66396563383635303136393666313630343265616465643634663764656562396662613133323034
          62623437373835333532313431343664333664613732666135313030353935656236353230643932
          63363631353436656263366630643932313339643636656435646363336465613639393132646361
          65653262643332653061383262643433326638336564633034306439666535373663353139346366
          62303639323634663930366536343464663739353764313932663462646138623234393237646233
          62616262653262323963656234303262393762623532653630346338326432666463386636656136
          32306231633866366639376332613033306134653030373836386634373864306233316437313964
          65393865336465333033336237326431653230666232663865393937363966616336646231306163
          61323232616138343930396332343465386530383461333930326633663537663033343039643261
          64313162366266636130643933646238343730366536393061333834316363386233343761663865
          39363161366537643435343130626566353530323136333534313331366666333238613963346331
          31613534353030646366333734653230663232306264383837656565613364666636333138323433
          35363230333166623632613438353266636362623631613931303335303937346666633263616465
          36633336646234646464643135626466306332616132643262643933633030323566363630323264
          34376334653037383531336362306465653433363965663664313839396135366366393631356365
          38343936303065303836616430633133666433633938356330366135333332363631353731336563
          64373065353434363266393230396565356264626438386233396162303237353065383961663165
          62643533623365373731626565343233643135623662653232653930333230343562313730663436
          62366134666263333630316139646132633832326238366133323963626163323465366336653337
          30323463613163383235323263613566383964343739353935386130643631663733323961666164
          63386238643766306138383762346331613633633334313535623566386336636230383664343134
          35383837356665363838316436623232623966393935333864616264393064393564646237653239
          39323034333333333933343866306433383161663435346337323063363264363830633930633163
          64346334333131653261386262656233636633313564316466646664636636643365396465616634
          33376637366238616137633538316339333364316631356531346562363630633637313239393237
          66636665313832613337616166333165393536633566376437326532396436303437363938396266
          61373436303166373439363361663432386431396534383666653134366563333430636266366264
          36366536383239343133653931373934613632613561363036303837613137373739323436616232
          61376236383631393133346639356239646564366435663639623163326164343030303433303633
          30643634663331393835666537383861306132353465663437373234656465356133636234346662
          61646538303836383237313632653035626232363433366531623964396636663434633835393035
          64303039343064666239613338313031356666396366616631643732386561356339303234653432
          34316661396536353836316539386535356237373963336462303938393262386139313131663939
          33353036386666643739363837316666653835306532363232653261613433346662336334656663
          30643432316432346432653339396637363033633039306665626662643135656662356636343137
          61363066303935346632623839373034323533356565363063383663323537633438366566396166
          66383733653766393362336565633164376563396637653839663739376336396536333131363532
          34333435383539623763396133373465323035323930623064336631323961633064396536373937
          34326464616139323032663361383332373966666663376165653364643337633436313234656439
          30616235303833636163303338613135333333306534396430316335396338353264623338336331
          66333139616537623436393961663332313864613231326432653233343636623931313134376365
          31323330313461373534653236303731343566373533636266306638363138303732316261376438
          31303062346563626435393836363536373136353461393838633434303935353738353135663664
          31653538643766653235316166666237353964666239393265363664346232653337663666343335
          64613661303434306333633964393666313732303830643965613832346566343964363466393133
          37323332373837316266366335303134616239633466323766383130636137326137663366663663
          35393738353331646630353732373066386439393237643136393634366430323064316131336138
          62366666366562666532663437353137613636643739383563663666313638383731333264343730
          36333635613439343565346537373165613761356538623263383538623133393334626637303163
          61366561366136653331633434306532666566613831613836396638613164306439346165343432
          61663066383563623331356464303262346264346238656263373362623962326636343633336264
          64393965386633316231323364643034383765613835663162313235323136336234626664393662
          35663239663266663731343234353562373864313634313439336432623637343164336461393865
          66303536333763303238623765393736396466383530393134343263306661636263323331616662
          33333261666661646461623431346465633763393161636131323861653831363038313237633037
          36646233306232326530356433333565663934373561653939616636663130373561343365346563
          61323262383831373237383630306538353166353536373337393434326330356131306661383536
          30386631643964323835336236333030663663396161356332333661316235643438393662346136
          61356537636261363966613439363663316638653436396233323366613132383237626336636466
          65346262353730656535303266636664396363646436336266373863643437653134333861656333
          63333332316330623434326638373865343636306138663835343738663566656661306663633166
          39303332663365663162343032653732343732666339643130313466356439386465303032396164
          33336162623033666264316638653231616365623966636230633631363165356466303662386538
          32653433343361316436376466363236306330363663636336323437356139376461636135633138
          62636234646530633737343435326235303961386630653066646663363831363962393138323664
          37393761323664353531353037613266636330386430656535346534343334363366336438306163
          62313965656361626531663733383136616633376331306530666663346537383236616334323734
          36366530346166653132393139363533336161393162366336326539666236363965303432333365
          39623531363264643631636565306162653537666462363266323137363261656361333161626437
          64313737326538613662393261303138616535373031653533643931346630656533386535363863
          65343638353761303932623135616661666435333765653266343131646631623336356135326361
          35636166313232323139643332313138626565656134356531353862353465323135623536656132
          35656537356364323731623532303135373031363961653433363736303938646539636365386664
          34373033613232663730343166613365373837316237396465376332353435373664393031383239
          38316364353864376565616666383239303966343066356661613134396434363637333462616136
          66356531393930306135373666366332396637656534303636646266393838363838306132643231
          37323931656137333932396237643830306166366466343466383433373535356361303864653462
          38663632343234373335646266663939663738323332363863323066383362366430383633376132
          30376163303466316464303234343932336638666339316135313639666230343335383664666436
          31326463663862396331383865643035306133643665333861353531636238626164666565366339
          34373039653337303531366666313230373465383666326237653539356339653461366430626231
          39363864353237356338626263656634643231303938386564616338643236353230623964663533
          64656663303136336162343266343537363334643663303663616262633835376331313636636337
          35656266383736343332613437336463386533643963306665626534356162323039366233646639
          31613430346632623230373533386236643333343962623739656665343833316636653836643838
          66346566393365653463356136343436616330343334653463626632633533363138313533633038
          31303438353833306465373230616439386330396631613035613332633939636261663335366637
          66656435383730643762343639636332613262366139333864626366353761306636313961396165
          63373965313233366433353830333436653230383135643063383034353661313461623430323030
          32366134653065343435333634386134383831343438323731363730653065643462326261663432
          31643965633962633266366436306261363734613261353861666338333930636336626462306433
          63356361393033346262306666663935363433323638663465666538316632663132346463663366
          30643735303363353538323863646633643436336435323734373762393761643438363238343865
          34663439316663353031346339613065313562383134393061666134666539656334303739386633
          65303437373534323336633639346338653437326332303237663034333036303537303439343238
          64343638363535376433323165376636333636653761636664346362356166383331366263646335
          61373130623131636635376662346564306239316331386566623535613639666464333237393063
          31303365383566376236336635363932663639616237313862636334356163363038396532653731
          30396639346334356463653336326663396238646639346332643864363630636266333363656137
          34613539343266323937396131306465303661636132316338623762636533326633626534383134
          33333930326663333138663036336566383637363566353361353962613039346635383262383331
          61616661333532373131646465633165336665343364373062336138363863613635363535626433
          63643461666461633163663434396333363534653064356666333239653136633536363665393166
          34313134353238636634356232353538616262363864623337623233633033303834613730336462
          35643535323736636166633562363735356137653464353937356361653138646633376630363562
          31393935313236396630343732373061613830323635633032313730653434666231666639653430
          31343336353334613963326333363736303739383033373761336661343834623430303037353939
          33636365303366663830373261373638363035303739313037633936396163353033343461376531
          63643835343439326234326432343437316330613937373566313562353237363937613730646665
          34626533306439353765366538653164363063613362386332376264306138386538396163356432
          36393631386637653938626266313737633964323263383164643465373631303932663830653866
          32656437383066613066306166303234376362303764666135346434616339643530333336626332
          32336130613362636437306638363561373435313939376366393866343138303662643065313866
          34303064373063373035366137346466396561306662623935316262343534623663646537626464
          62343061376434326564373962363038363533376437333763613665373861663032633566356666
          34623364306639393534633964666335356639613737653438363539313635323935303737333937
          38363031313538646333366537653937313562313637653433373066346435633536666333663436
          36666362383963333865316330633562383330623035396663366262356161373737383338643566
          30616232383635653765313864346466376365303831386638303763323530373264343762353330
          33306331373032663033646661643437303932646335323634666461363534306665386166646365
          33323538316636396336616466353334363364386232303637636537393839323639623438333761
          34373439643930393835313335653866643437666562623632656263396636646566366262393038
          30653362316463623534303861396533623734313230656633366166613861393764303730353966
          65313234333930663333396636656434656138336562376566383163636530656466613661626139
          63303838363735346463643932323737643663333962383565643538313631653137646133653364
          33396131333365373232616239393238333830396531386536323966386539646162346239656433
          63376131613937353064323565303461316330393432653366613065343535383131333434333963
          32366236623234656264343361653738646535656365323131613235616631623737636438333238
          30653631653238656534383466613839326136316163303034633166333966623831333836356235
          30356663303165343562303931623233623164666535356533626631643561323439306565326534
          65613663306262633561663066653265656336346130613062633635663331366537643963656131
          62383438336533656266383464353632386565373362303262376131303233376638613237336133
          6333626236616565336262366133633861663035393964333663
      when: not github_air_rsa_stat.stat.exists
    - name: add identity to ssh config
      lineinfile:
        dest: ~/.ssh/config
        create: yes
        state: present
        line: IdentityFile ~/.ssh/github_air_rsa
      when: not github_air_rsa_stat.stat.exists
    - name: add github key to ssh
      shell: ssh-add ~/.ssh/github_air_rsa
      when: not github_air_rsa_stat.stat.exists

    # install pushover config
    - name: register .pushoverrc stat
      stat: path="~/.pushoverrc"
      register: pushoverrc_stat
    - name: install pushover config
      copy:
        dest: ~/.pushoverrc
        mode: 0600
        content: |
          $ANSIBLE_VAULT;1.1;AES256
          61303363653566643832353138343331333231656265373838666336666235646238396433653531
          3835653162643539656565326430323330656165653966350a383864643564383039373932336535
          31336238356137353130386565313337306132313633643166303961336230353934666636303863
          3333643535393532630a363530353937343438323435333630313937363765626332326138656464
          66396537366664343264396263646139376231386135343533306566363262356231333661653163
          39613537336161653334336637643937666139313162353739323366613261326563613738313934
          34613262646434356437313164366633363366313731373962626163666137306638613739323761
          36343034353736383538373062373165646439353434393937373764666563653032353532376634
          66616139326233393963323030323831646138396339316336386435393132616234393235326231
          30663939363032656538653537366234326236333366646337303562383837376635616237643563
          35393437316665386132326662626332613531303366363137306236633861323562306230326630
          66326263646464666263393366636662613131653562643863666333373363626639623461633238
          36333766333036303736316530663735613030666262643834653338356462323631386335663738
          6131346534363332626632643461653532623963613934393831
      when: not pushoverrc_stat.stat.exists

    # setup bash profile
    - name: register .profile stat
      stat: path="~/.profile"
      register: profile_stat
    - name: setup .profile
      copy: src="files/.profile" dest="~"
      when: not profile_stat.stat.exists

    # install mackup config
    - name: register .mackup.cfg stat
      stat: path="~/.mackup.cfg"
      register: mackupcfg_stat
    - name: setup .mackup.cfg
      copy: src="files/.mackup.cfg" dest="~"
      when: not mackupcfg_stat.stat.exists

    # set finder to not show hard disks
    - name: register ShowHardDisks
      shell: /usr/libexec/PlistBuddy -c "print :systemitems:ShowHardDisks" ~/Library/Preferences/com.apple.sidebarlists.plist
      register: showharddisks_default
      changed_when: false
      ignore_errors: yes
    - name: set ShowHardDisks
      shell: /usr/libexec/PlistBuddy -c "set :systemitems:ShowHardDisks NO" ~/Library/Preferences/com.apple.sidebarlists.plist
      when: showharddisks_default.stdout != 'NO'

    # set finder toolbar items
    - name: check for toolbar configuration dict
      shell: /usr/libexec/PlistBuddy -c "print :'NSToolbar Configuration Browser'" ~/Library/Preferences/com.apple.finder.plist
      register: toolbar_configuration_check_result
      changed_when: false
      ignore_errors: yes
    - name: add toolbar configuration dict
      shell: /usr/libexec/PlistBuddy -c "add :'NSToolbar Configuration Browser' dict" ~/Library/Preferences/com.apple.finder.plist
      when: toolbar_configuration_check_result.rc
    - name: check for toolbar item settings array
      shell: /usr/libexec/PlistBuddy -c "print :'NSToolbar Configuration Browser:TB Item Identifiers'" ~/Library/Preferences/com.apple.finder.plist
      register: toolbar_check_result
      changed_when: false
      ignore_errors: yes
    - name: add toolbar item settings array
      shell: /usr/libexec/PlistBuddy -c "add :'NSToolbar Configuration Browser:TB Item Identifiers' array" ~/Library/Preferences/com.apple.finder.plist
      when: toolbar_check_result.rc
    - name: add toolbar item setting entries
      shell: /usr/libexec/PlistBuddy -c "add :'NSToolbar Configuration Browser:TB Item Identifiers:' string '{{ item }}'" ~/Library/Preferences/com.apple.finder.plist
      when: toolbar_check_result.rc
      with_items:
        - com.apple.finder.BACK
        - NSToolbarFlexibleSpaceItem
        - com.apple.finder.SWCH
        - com.apple.finder.PATH
        - NSToolbarSpaceItem
        - com.apple.finder.SHAR
        - com.apple.finder.ACTN
        - NSToolbarFlexibleSpaceItem
        - NSToolbarFlexibleSpaceItem
        - com.apple.finder.SRCH

    # set finder toolbar items to item only
    - name: register toolbar display mode
      shell: /usr/libexec/PlistBuddy -c "print :'NSToolbar Configuration Browser:TB Display Mode'" ~/Library/Preferences/com.apple.finder.plist
      register: tbdisplaymode_default
      changed_when: false
      ignore_errors: yes
    - name: set toolbar display mode
      shell: /usr/libexec/PlistBuddy -c "add :'NSToolbar Configuration Browser:TB Display Mode' integer 2" ~/Library/Preferences/com.apple.finder.plist
      when: tbdisplaymode_default.stdout != '2'

    # set finder icon view settings
    - name: set finder icon view settings
      shell: /usr/libexec/PlistBuddy -c "set :'StandardViewSettings:IconViewSettings:{{ item.property }}' {{ item.value }}" ~/Library/Preferences/com.apple.finder.plist
      with_items:
        - property: gridSpacing
          value: 30
        - property: textSize
          value: 12
        - property: showItemInfo
          value: false
        - property: iconSize
          value: 44
        # 'name' really maps to 'sort by'
        - property: arrangeBy
          value: name

    # set finder desktop view settings
    - name: set finder desktop view settings
      shell: /usr/libexec/PlistBuddy -c "set :'DesktopViewSettings:IconViewSettings:{{ item.property }}' {{ item.value }}" ~/Library/Preferences/com.apple.finder.plist
      with_items:
        - property: gridSpacing
          value: 25
        - property: textSize
          value: 12
        - property: iconSize
          value: 44
        - property: arrangeBy
          value: grid

    - name: set OS X defaults
      osx_defaults: domain={{ item.domain }} key={{ item.key }} type={{ item.type }} value={{ item.value }}
      with_items:
        # set tap-to-click
        - domain: NSGlobalDomain
          key: com.apple.mouse.tapBehavior
          type: integer
          value: 1
        # set output sound when changing volume
        - domain: NSGlobalDomain
          key: com.apple.sound.beep.feedback
          type: integer
          value: 1

        - domain: 'NSGlobalDomain'
          key: 'NSTableViewDefaultSizeMode'
          type: integer
          value: 1
        - domain: 'NSGlobalDomain'
          key: 'NSNavPanelExpandedStateForSaveMode'
          type: boolean
          value: true
        - domain: 'NSGlobalDomain'
          key: 'AppleActionOnDoubleClick'
          type: string
          value: 'Minimize'

        # screen saver
        - domain: 'com.apple.screensaver'
          key: 'askForPassword'
          type: integer
          value: 0

        # set tabbing between all UI elements
        - domain: 'NSGlobalDomain'
          key: 'AppleKeyboardUIMode'
          type: integer
          value: 2

        # clock
        - domain: 'com.apple.menuextra.clock'
          key: 'IsAnalog'
          type: integer
          value: 1

        # finder
        - domain: 'com.apple.finder'
          key: 'ShowTabView'
          type: boolean
          value: true
        - domain: 'com.apple.finder'
          key: 'ShowRecentTags'
          type: boolean
          value: false
        - domain: 'com.apple.finder'
          key: 'ShowExternalHardDrivesOnDesktop'
          type: boolean
          value: false
        - domain: 'com.apple.finder'
          key: 'ShowHardDrivesOnDesktop'
          type: boolean
          value: false
        - domain: 'com.apple.finder'
          key: 'NewWindowFilePath'
          type: string
          value: 'file:///Users/marcus/'

        # dock
        - domain: 'com.apple.dock'
          key: 'autohide'
          type: boolean
          value: true
        - domain: 'com.apple.dock'
          key: 'minimize-to-application'
          type: boolean
          value: true
        - domain: 'com.apple.dock'
          key: 'show-process-indicators'
          type: boolean
          value: true
        - domain: 'com.apple.dock'
          key: 'tilesize'
          type: float
          value: 55
        - domain: 'com.apple.dock'
          key: 'wvous-tl-corner'
          type: integer
          value: 10
        - domain: 'com.apple.dock'
          key: 'wvous-tl-modifier'
          type: integer
          value: 0
        - domain: 'com.apple.dock'
          key: 'wvous-tr-corner'
          type: integer
          value: 4
        - domain: 'com.apple.dock'
          key: 'wvous-tr-modifier'
          type: integer
          value: 0

        # set mouse settings
        - domain: 'com.apple.driver.AppleHIDMouse'
          key: 'Button2'
          type: integer
          value: 2
        - domain: 'com.apple.driver.AppleHIDMouse'
          key: 'ButtonDominance'
          type: integer
          value: 1

        # trackpad
        - domain: 'com.apple.driver.AppleBluetoothMultitouch.trackpad'
          key: 'Clicking'
          type: integer
          value: 1
        - domain: 'com.apple.AppleMultitouchTrackpad'
          key: 'Clicking'
          type: integer
          value: 1
        - domain: 'com.apple.dock'
          key: 'showAppExposeGestureEnabled'
          type: integer
          value: 1

    - name: set OS X defaults for currentHost
      osx_defaults: host=currentHost domain={{ item.domain }} key={{ item.key }} type={{ item.type }} value={{ item.value }}
      with_items:
        # set tap-to-click
        - domain: NSGlobalDomain
          key: com.apple.mouse.tapBehavior
          type: integer
          value: 1

    - name: register Mac App Store applications
      shell: mas list
      register: mas_list
      changed_when: False

    - name: install Mac App Store applications
      shell: mas install {{ item }}
      when: "'{{ item }}' not in mas_list.stdout"
      with_items:
        - 1107421413  # 1blocker
        - 402355593   # chronicle
        - 1059655371  # newton
        - 1026349850  # copied
        - 1055511498  # day one
        - 924726344   # deliveries
        - 975937182   # fantastical
        - 407963104   # pixelmator
        - 568494494   # pocket
        - 880001334   # reeder
        - 446107677   # screens
        - 577085396   # unclutter
        - 497799835   # xcode

    - name: clone third party git repositories
      git: repo={{item.repo}}.git dest={{item.dest}}
      with_items:
        - repo: https://github.com/Cortys/comic-backup.git
          dest: ~/Development/third-party/comics-backup
